---
import Layout from '../../layouts/Layout.astro';
import Chatbot from '../../components/Chatbot.astro';

// Leemos las variables de entorno como antes.
const n8nHost = import.meta.env.PUBLIC_N8N_HOST;
const n8nWebhookId = import.meta.env.PUBLIC_N8N_WEBHOOK_ID;

const isConfigured = n8nHost && n8nWebhookId;
---

<Layout title="Asistente de Modelo de Negocio">
  <section class="py-20 bg-white">
    <div class="container mx-auto px-8 flex flex-col items-center">
      <div class="text-center max-w-3xl mx-auto">
        <h1 class="font-heading text-4xl md:text-5xl font-bold text-dark-gray">
          Asistente Interactivo para tu Modelo de Negocio
        </h1>
        <p class="mt-4 text-lg text-dark-gray/80">
          Este chatbot te guiará paso a paso para definir los 9 bloques del
          Lienzo de Modelo de Negocio (Business Model Canvas).
        </p>
      </div>

      <!-- Renderizado condicional del Chatbot -->
      {
        isConfigured ? (
          // 1. Creamos un contenedor con un tamaño definido (alto y ancho).
          //    El chatbot se renderizará para llenar este espacio.
          <div class="mt-12 w-full max-w-3xl h-[70vh] min-h-[500px] border border-gray-200 rounded-lg shadow-md">
            {/* 2. Llamamos al componente con mode="embed" */}
            <Chatbot
              host={n8nHost}
              webhookId={n8nWebhookId}
              mode="embed"
              title="Asistente de Lienzo de Negocio"
              initialBotMessage="¡Hola! Soy tu asistente para el Modelo de Negocio. ¿Estás listo para comenzar?"
              class="h-full w-full"
            />
          </div>
        ) : (
          <div class="mt-12 w-full max-w-2xl text-center p-8 bg-red-100 border border-red-400 text-red-700 rounded-lg">
            <h3 class="font-bold text-lg">Error de Configuración</h3>
            <p class="mt-2">
              El chatbot no se puede mostrar porque las variables de entorno no
              están configuradas correctamente.
            </p>
          </div>
        )
      }
    </div>
  </section>
</Layout>